---
title: Configurar o Skype for Business Server para usar o armazenamento unificado de contatos
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
description: 'Resumo: Configure o armazenamento unificado de contatos para o Exchange Server e o Skype for Business Server.'
ms.openlocfilehash: 9d9601e7a060b6d93a27e872bf05f798d470aa85
ms.sourcegitcommit: 01087be29daa3abce7d3b03a55ba5ef8db4ca161
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/23/2021
ms.locfileid: "51095985"
---
# <a name="configure-skype-for-business-server-to-use-the-unified-contact-store"></a><span data-ttu-id="8ec5a-103">Configurar o Skype for Business Server para usar o armazenamento unificado de contatos</span><span class="sxs-lookup"><span data-stu-id="8ec5a-103">Configure Skype for Business Server to use the unified contact store</span></span>
 
<span data-ttu-id="8ec5a-104">**Resumo:** Configure o armazenamento unificado de contatos para o Exchange Server 2016 ou Exchange Server 2013 e o Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-104">**Summary:** Configure the unified contacts store for Exchange Server 2016 or Exchange Server 2013 and Skype for Business Server.</span></span>
  
<span data-ttu-id="8ec5a-105">Usando o armazenamento unificado de contatos, os usuários mantêm uma única lista de contatos e, em seguida, têm esses contatos disponíveis em vários aplicativos, incluindo o Skype for Business, o Microsoft Outlook 2013 e o Microsoft Outlook Web App 2013.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-105">Using the unified contact store, users maintain a single contacts list and then have those contacts available in multiple applications, including Skype for Business, Microsoft Outlook 2013, and Microsoft Outlook Web App 2013.</span></span> <span data-ttu-id="8ec5a-106">Quando você habilita o armazenamento unificado de contatos para um usuário, os contatos desse usuário não são armazenados no Skype for Business Server e recuperados conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-106">When you enable the unified contact store for a user, that user's contacts are not stored in Skype for Business Server and retrieved as needed.</span></span> <span data-ttu-id="8ec5a-107">Em vez disso, seus contatos são armazenados no Exchange Server 2016 ou Exchange Server 2013 e são recuperados usando os Serviços Web do Exchange.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-107">Instead, his or her contacts are stored in Exchange Server 2016 or Exchange Server 2013 and are retrieved by using Exchange Web Services.</span></span>
  
> [!NOTE]
> <span data-ttu-id="8ec5a-108">Tecnicamente, as informações de contato são armazenadas em um par de pastas encontradas na caixa de correio do Exchange do usuário.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-108">Technically, contact information is stored in a pair of folders found in the user's Exchange mailbox.</span></span> <span data-ttu-id="8ec5a-109">Os próprios contatos são armazenados em uma pasta chamada Skype for Business Contacts que fica visível para os usuários finais; os metadados sobre os contatos são armazenados em uma subpasta que não está visível para os usuários finais.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-109">The contacts themselves are stored in a folder named Skype for Business Contacts which is visible to end users; metadata about the contacts are stored in a subfolder that is not visible to end users.</span></span> 
  
## <a name="enabling-the-unified-contact-store-for-a-user"></a><span data-ttu-id="8ec5a-110">Habilitando o repositório unificado de contatos para um usuário</span><span class="sxs-lookup"><span data-stu-id="8ec5a-110">Enabling the Unified Contact Store for a User</span></span>

<span data-ttu-id="8ec5a-111">Se a autenticação de servidor para servidor entre o Skype for Business Server e o Exchange Server já estiver configurada, você também habilitará o armazenamento unificado de contatos; nenhuma configuração adicional do servidor é necessária.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-111">If server-to-server authentication between Skype for Business Server and Exchange Server is already configured, then you have also enabled the unified contact store; no additional server configuration is required.</span></span> <span data-ttu-id="8ec5a-112">No entanto, será necessária configuração adicional da conta do usuário para transferir os contatos de um usuário para o repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-112">However, additional user account configuration is required in order to move a user's contacts into the unified contact store.</span></span> <span data-ttu-id="8ec5a-113">Por padrão, os contatos do usuário são mantidos no Skype for Business Server e não no armazenamento unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-113">By default, user contacts are kept in Skype for Business Server and not in the unified contact store.</span></span>
  
<span data-ttu-id="8ec5a-114">O acesso ao armazenamento unificado de contatos é gerenciado usando políticas de serviços de usuário do Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-114">Access to the unified contact store is managed by using Skype for Business Server user services policies.</span></span> <span data-ttu-id="8ec5a-115">As políticas de serviços de usuário têm uma única propriedade (UcsAllowed), que é usada para determinar o local onde os contatos de um usuário são armazenados.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-115">User server policies have only a single property (UcsAllowed); this property is used to determine the location where a user's contacts are stored.</span></span> <span data-ttu-id="8ec5a-116">Se um usuário for gerenciado por uma política de serviços de usuário na qual UcsAllowed foi definido como True ($True), os contatos do usuário serão armazenados no armazenamento unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-116">If a user is managed by a user services policy where UcsAllowed has been set to True ($True) then the user's contacts will be stored in the unified contact store.</span></span> <span data-ttu-id="8ec5a-117">Se o usuário for gerenciado por uma política de serviços de usuário na qual UcsAllowed foi definido como False ($False), seus contatos serão armazenados no Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-117">If the user is managed by a user services policy where UcsAllowed has been set to False ($False) then his or her contacts will be stored in Skype for Business Server.</span></span>
  
<span data-ttu-id="8ec5a-118">Quando você instala o Skype for Business Server, uma única política de serviços de usuário (configurada no escopo global) também é instalada.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-118">When you install Skype for Business Server, a single user services policy (configured at the global scope) is installed as well.</span></span> <span data-ttu-id="8ec5a-119">O valor UcsAllowed nesta política é definido como True, o que significa que, por padrão, os contatos do usuário serão armazenados no armazenamento unificado de contatos (supondo que isso tenha sido implantado e configurado).</span><span class="sxs-lookup"><span data-stu-id="8ec5a-119">The UcsAllowed value in this policy is set to True, meaning that, by default, user contacts will be stored in the unified contact store (assuming this has been deployed and configured).</span></span> <span data-ttu-id="8ec5a-120">Se você deseja migrar todos os seus contatos de usuário para o armazenamento unificado de contatos, não é preciso fazer nada.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-120">If you want to migrate all of your user contacts to the unified contact store you do not have to do anything at all.</span></span> 
  
<span data-ttu-id="8ec5a-121">Se você preferir não migrar todos os seus contatos para o armazenamento unificado de contatos, poderá desabilitar o armazenamento unificado de contatos para todos os usuários definindo a propriedade UcsAllowed na política global como False:</span><span class="sxs-lookup"><span data-stu-id="8ec5a-121">If you would prefer not to migrate all your contacts to the unified contact store you can disable the unified contact store for all users by setting the UcsAllowed property in the global policy to False:</span></span>
  
```powershell
Set-CsUserServicesPolicy -Identity global -UcsAllowed $False
```

<span data-ttu-id="8ec5a-122">Depois de desabilitado o armazenamento unificado de contatos na política global, você pode criar uma política por usuário que habilita o uso do armazenamento unificado de contatos; Isso permite que alguns usuários mantenham seus contatos no armazenamento unificado de contatos enquanto outros usuários continuam mantendo seus contatos no Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-122">After you have disabled the unified contact store in the global policy you can then create a per-user policy that enables the use of the unified contact store; this allows you to have some users keep their contacts in the unified contact store while other users continue to keep their contacts in Skype for Business Server.</span></span> <span data-ttu-id="8ec5a-123">Você pode criar uma política de serviços de usuário por usuário usando um comando semelhante a este:</span><span class="sxs-lookup"><span data-stu-id="8ec5a-123">You can create a per-user user services policy by using a command similar to this:</span></span>
  
```powershell
New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True
```

<span data-ttu-id="8ec5a-p107">Depois que você tiver criado a nova política, precisará atribuí-la aos usuários que deverão ter acesso ao repositório unificado de contatos. As políticas por usuário podem ser atribuídas aos usuários com o uso de comandos semelhantes ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="8ec5a-p107">After you have created the new policy you must then assign that policy to any user who should have access to the unified contact store. Per-user policies can be assigned to users by using commands similar to this:</span></span>
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"
```

<span data-ttu-id="8ec5a-126">Depois que a política for atribuída, o Skype for Business Server começará a migrar os contatos do usuário para o armazenamento unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-126">After the policy has been assigned, Skype for Business Server will begin to migrate the user's contacts to the unified contact store.</span></span> <span data-ttu-id="8ec5a-127">Depois que a migração for concluída, o usuário terá seus contatos armazenados no Exchange em vez do Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-127">After migration is complete, the user will then have his or her contacts stored in Exchange rather than Skype for Business Server.</span></span> <span data-ttu-id="8ec5a-128">Se o usuário estiver conectado ao Lync 2013 no momento em que a migração for concluída, uma caixa de mensagem aparecerá e ele será solicitado a fazer logon no Skype for Business e fazer logon novamente para finalizar o processo.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-128">If the user happens to be logged on to Lync 2013 at the time migration completes, a message box will appear and he or she will be asked to log off of Skype for Business and then log back on in order to finalize the process.</span></span> <span data-ttu-id="8ec5a-129">Os usuários que não foram atribuídos a essa política por usuário não terão seus contatos migrados para o armazenamento unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-129">Users who have not been assigned this per-user policy will not have their contacts migrated to the unified contact store.</span></span> <span data-ttu-id="8ec5a-130">Isso porque esses usuários estão sendo gerenciados pela política global e o uso do armazenamento unificado de contatos foi desabilitado na política global.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-130">That's because those users are being managed by the global policy, and use of the unified contact store has been disabled in the global policy.</span></span>
  
<span data-ttu-id="8ec5a-131">Você pode verificar se os contatos de um usuário foram migrados com êxito para o repositório de contatos unificado executando o cmdlet [Test-CsUnifiedContactStore](/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) no Shell de Gerenciamento do Skype for Business Server:</span><span class="sxs-lookup"><span data-stu-id="8ec5a-131">You can verify that a user's contacts have successfully been migrated to the unified contact store by running the [Test-CsUnifiedContactStore](/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) cmdlet from within the Skype for Business Server Management Shell:</span></span>
  
```powershell
Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
```

<span data-ttu-id="8ec5a-132">Se Test-CsUnifiedContactStore tiver êxito, isso significa que os contatos do usuário sip:kenmyer@ <span></span> litwareinc .com foram migrados para o armazenamento <span></span> unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-132">If Test-CsUnifiedContactStore succeeds that means that the contacts for the user sip:kenmyer@<span></span>litwareinc<span></span>.com have been migrated to the unified contact store.</span></span>
  
## <a name="rolling-back-the-unified-contact-store"></a><span data-ttu-id="8ec5a-133">Revertendo o repositório unificado de contatos</span><span class="sxs-lookup"><span data-stu-id="8ec5a-133">Rolling Back the Unified Contact Store</span></span>

<span data-ttu-id="8ec5a-134">Se você precisar remover os contatos de um usuário do armazenamento unificado de contatos (por exemplo, se o usuário precisar ser reemocupado no Microsoft Lync Server 2010 e, portanto, não puder mais usar o armazenamento unificado de contatos), você deve fazer duas coisas.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-134">If you need to remove a user's contacts from the unified contact store (for example, if the user needs to be rehomed on Microsoft Lync Server 2010 and thus can no longer use the unified contact store) you must do two things.</span></span> <span data-ttu-id="8ec5a-135">Primeiro, você deve atribuir ao usuário uma nova política de serviços de usuário, uma que proíbe o armazenamento de contatos no armazenamento unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-135">First, you must assign the user a new user services policy, one that prohibits storing contacts in the unified contact store.</span></span> <span data-ttu-id="8ec5a-136">(Ou seja, uma política em que a propriedade UcsAllowed foi definida como $False.) Se você não tiver essa política, poderá criar uma usando um comando semelhante a este:</span><span class="sxs-lookup"><span data-stu-id="8ec5a-136">(That is, a policy where the UcsAllowed property has been set to $False.) If you do not have such a policy you can create one using a command similar to this:</span></span>
  
```powershell
New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False
```

<span data-ttu-id="8ec5a-137">Em seguida, você pode atribuir essa nova política por usuário (NoUnifiedContactStore) usando um comando como o seguinte:</span><span class="sxs-lookup"><span data-stu-id="8ec5a-137">You can then assign this new per-user policy (NoUnifiedContactStore) by using a command like this:</span></span>
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore
```

<span data-ttu-id="8ec5a-138">O comando anterior atribui a nova política ao usuário Ken Myer e também impede que os contatos de Ken sejam migrados para o repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-138">The preceding command assigns the new policy to the user Ken Myer, and also prevents Ken's contacts from being migrated to the unified contact store.</span></span>
  
> [!NOTE]
> <span data-ttu-id="8ec5a-139">Em alguns casos, você pode obter o mesmo efeito líquido simplesmente desem atribuir a política de serviços de usuário atual do usuário.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-139">In some cases you can achieve the same net effect by simply un-assigning the user's current user services policy.</span></span> <span data-ttu-id="8ec5a-140">Por exemplo, suponha que Ken Myer tenha uma política de serviços de usuário por usuário que habilita o repositório unificado de contatos, mas sua política global proíbe o uso do repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-140">For example, suppose Ken Myer has a per-user user services policy the enables the unified contact store, but your global policy prohibits the use of the unified contact store.</span></span> <span data-ttu-id="8ec5a-141">Nesse caso, você pode desem atribuir a política de serviços por usuário de Ken.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-141">In that case, you could un-assign Ken's per-user services policy.</span></span> <span data-ttu-id="8ec5a-142">Quando você fizer isso, Ken será automaticamente gerenciado pela política global e deixará de ter acesso ao repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-142">When you do that, Ken will automatically be managed by the global policy, and thus will no longer have access to the unified contact store.</span></span> <span data-ttu-id="8ec5a-143">Para desatribuição de uma política atribuída anteriormente por usuário, use o mesmo comando mostrado anteriormente, mas desta vez de definir o parâmetro PolicyName como um valor nulo: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null</span><span class="sxs-lookup"><span data-stu-id="8ec5a-143">To un-assign a previously-assigned per-user policy, use the same command as shown before, but this time set the PolicyName parameter to a null value: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null</span></span> 
  
<span data-ttu-id="8ec5a-144">É importante lembrar-se da frase "impede que os contatos de Ken sejam migrados para o repositório unificado de contatos" ao trabalhar com o repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-144">The terminology "prevents Ken's contacts from being migrated to the unified contact store" is important to keep in mind when working with the unified contact store.</span></span> <span data-ttu-id="8ec5a-145">Simplesmente atribuir uma nova política de serviços de usuário a Ken não removerá seus contatos do repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-145">Simply assigning Ken a new user services policy will not move his contacts out of the unified contact store.</span></span> <span data-ttu-id="8ec5a-146">Quando um usuário faz o login no Skype for Business Server, o sistema verifica a política de serviços de usuário do usuário para ver se seus contatos devem ser mantidos no armazenamento unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-146">When a user logs on to Skype for Business Server, the system checks the user's user services policy to see whether his or her contacts should be kept in the unified contact store.</span></span> <span data-ttu-id="8ec5a-147">Se a resposta for sim (ou seja, se a propriedade UcsAllowed estiver definida como $True), esses contatos serão migrados para o repositório unificado de contatos (pressupondo que eles ainda não estejam no repositório unificado de contatos).</span><span class="sxs-lookup"><span data-stu-id="8ec5a-147">If the answer is yes (that is, if the UcsAllowed property is set to $True) then those contacts will be migrated to the unified contact store (assuming that those contacts are not already in the unified contact store).</span></span> <span data-ttu-id="8ec5a-148">Se a resposta for não, o Skype for Business Server simplesmente ignorará os contatos do usuário e seguirá para sua próxima tarefa.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-148">If the answer is no, then Skype for Business Server simply ignores the user's contacts and moves on to its next task.</span></span> <span data-ttu-id="8ec5a-149">Isso significa que o Skype for Business Server não move automaticamente os contatos de um usuário do armazenamento unificado de contatos, independentemente do valor da propriedade UcsAllowed.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-149">That means that Skype for Business Server will not automatically move a user's contacts from out of the unified contact store, regardless of the value of the UcsAllowed property.</span></span>
  
<span data-ttu-id="8ec5a-150">Isso também significa que, depois de atribuir ao usuário uma nova política de serviços de usuário, você deve executar o cmdlet [Invoke-CsUcsRollback](/powershell/module/skype/invoke-csucsrollback?view=skype-ps) para mover os contatos do usuário para fora do Exchange Server e voltar para o Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-150">That also means that, after assigning the user a new user services policy, you must then run the [Invoke-CsUcsRollback](/powershell/module/skype/invoke-csucsrollback?view=skype-ps) cmdlet in order to move the user's contacts out of Exchange Server and back to Skype for Business Server.</span></span> <span data-ttu-id="8ec5a-151">Por exemplo, após atribuir uma nova política de serviços de usuário a Ken Myer, você poderá remover seus contatos do repositório unificado de contatos usando o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="8ec5a-151">For example, after assigning Ken Myer a new user services policy you can then move his contacts out of the unified contact store by using the following command:</span></span>
  
```powershell
Invoke-CsUcsRollback -Identity "Ken Myer"
```

<span data-ttu-id="8ec5a-152">Se você alterar a política de serviços de usuário, mas não executar o cmdlet Invoke-CsUcsRollback, os contatos de Ken não serão removidos do repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-152">If you change the user services policy but do not run the Invoke-CsUcsRollback cmdlet Ken's contacts will not be removed from the unified contact store.</span></span> <span data-ttu-id="8ec5a-153">E se você executar o Invoke-CsUcsRollback, mas não alterar a política de serviços de usuário de Ken Myer?</span><span class="sxs-lookup"><span data-stu-id="8ec5a-153">What if you run Invoke-CsUcsRollback but do not change Ken Myer's user services policy?</span></span> <span data-ttu-id="8ec5a-154">Nesse caso, os contatos de Ken serão temporariamente removidos do repositório unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-154">In that case, Ken's contacts will be temporarily removed from the unified contact store.</span></span> <span data-ttu-id="8ec5a-155">É importante atentar ao fato de que essa remoção é temporária.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-155">The fact that this removal is temporary is important to keep in mind.</span></span> <span data-ttu-id="8ec5a-156">Depois que os contatos de Ken foram removidos do armazenamento unificado de contatos, o Skype for Business Server aguardará 7 dias e verificará qual política de serviços de usuário foi atribuída a Ken.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-156">After Ken's contacts have been removed from the unified contact store, Skype for Business Server will wait 7 days and then check to see which user services policy has been assigned to Ken.</span></span> <span data-ttu-id="8ec5a-157">Se uma política que permite o uso do repositório unificado de contatos ainda estiver atribuída a Ken, seus contatos serão automaticamente transferidos de volta para o repositório de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-157">If Ken is still assigned a policy that enables the user of the unified contact store, then his contacts will automatically be moved back to into the contact store.</span></span> <span data-ttu-id="8ec5a-158">Para remover permanentemente os contatos do repositório unificado de contatos, você precisa alterar a política de serviços de usuário e também executar o cmdlet Invoke-CsUcsRollback.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-158">To permanently remove contacts from the unified contact store you must change the user services policy in addition to running the Invoke-CsUcsRollback cmdlet.</span></span>
  
<span data-ttu-id="8ec5a-159">Devido ao grande número de variáveis que podem afetar a migração, é difícil estimar quanto tempo levará para que as contas sejam totalmente migradas para o armazenamento unificado de contatos.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-159">Due to the large number of variables that can affect migration, it is difficult to estimate how long it will take before accounts are fully migrated to the unified contact store.</span></span> <span data-ttu-id="8ec5a-160">Como regra geral, no entanto, a migração não entrará em vigor imediatamente: mesmo ao migrar um pequeno número de contatos, pode levar 10 minutos ou mais antes da conclusão da movimentação.</span><span class="sxs-lookup"><span data-stu-id="8ec5a-160">As a general rule, however, migration does not take effect immediately: even when migrating a small number of contacts it might take 10 minutes or more before the move is complete.</span></span>
