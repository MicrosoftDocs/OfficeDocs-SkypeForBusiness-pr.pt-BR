---
title: Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: 'Resumo: Estágio AV e certificados OAuth para Skype for Business Server.'
ms.openlocfilehash: a2586e9ebda1bae1605fd6033681b469e6731b8c
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/12/2021
ms.locfileid: "49806551"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a><span data-ttu-id="ebc32-103">Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="ebc32-103">Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate</span></span>
 
<span data-ttu-id="ebc32-104">**Resumo:** Stage AV and OAuth certificates for Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="ebc32-104">**Summary:** Stage AV and OAuth certificates for Skype for Business Server.</span></span>
  
<span data-ttu-id="ebc32-105">As comunicações de áudio/vídeo (A/V) são um componente essencial do Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="ebc32-105">Audio/Video (A/V) communications is a key component of Skype for Business Server.</span></span> <span data-ttu-id="ebc32-106">Recursos como compartilhamento de aplicativos e conferência de áudio e vídeo dependem dos certificados atribuídos ao serviço de Borda A/V, especificamente o serviço de Autenticação A/V.</span><span class="sxs-lookup"><span data-stu-id="ebc32-106">Features such as application sharing and audio and video conferencing rely on the certificates assigned to the A/V Edge service, specifically the A/V Authentication service.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="ebc32-107">Esse novo recurso foi projetado para funcionar para o serviço de Borda A/V e o certificado OAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="ebc32-107">This new feature is designed to work for the A/V Edge service and the OAuthTokenIssuer certificate.</span></span> <span data-ttu-id="ebc32-108">Outros tipos de certificado podem ser provisionados junto com o serviço de Borda A/V e o tipo de certificado OAuth, mas não se beneficiarão do comportamento de coexistência que o certificado de serviço de Borda A/V irá.</span><span class="sxs-lookup"><span data-stu-id="ebc32-108">Other certificate types can be provisioned along with the A/V Edge service and OAuth certificate type, but will not benefit from the coexistence behavior that the A/V Edge service certificate will.</span></span>
  
<span data-ttu-id="ebc32-109">Os cmdlets do PowerShell do Shell de Gerenciamento do Skype for Business Server usados para gerenciar certificados do Skype for Business Server referem-se ao certificado de serviço de Borda A/V como o tipo de certificado AudioVideoAuthentication e o certificado OAuthServer como typeOAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="ebc32-109">The Skype for Business Server Management Shell PowerShell cmdlets used to manage Skype for Business Server certificates refers to the A/V Edge service certificate as the AudioVideoAuthentication certificate type and the OAuthServer certificate as typeOAuthTokenIssuer.</span></span> <span data-ttu-id="ebc32-110">Para o restante deste tópico e para identificar exclusivamente os certificados, eles serão referidos pelo mesmo tipo de identificador, AudioVideoAuthentication eOAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="ebc32-110">For the rest of this topic and to uniquely identify the certificates, they will be referred to by the same identifier type, AudioVideoAuthentication andOAuthTokenIssuer.</span></span>
  
<span data-ttu-id="ebc32-111">O serviço de Autenticação A/V é responsável pela emissão de tokens usados por clientes e outros consumidores de A/V.</span><span class="sxs-lookup"><span data-stu-id="ebc32-111">The A/V Authentication service is responsible for issuing tokens that are used by clients and other A/V consumers.</span></span> <span data-ttu-id="ebc32-112">Os tokens são gerados a partir de atributos no certificado e, quando o certificado expirar, a perda de conexão e a necessidade de reesessar com um novo token gerado pelo novo certificado resultarão.</span><span class="sxs-lookup"><span data-stu-id="ebc32-112">The tokens are generated from attributes on the certificate, and when the certificate expires, loss of connection and requirement to rejoin with a new token generated by the new certificate will result.</span></span> <span data-ttu-id="ebc32-113">Um novo recurso no Skype for Business Server aliviará esse problema- a capacidade de criar um novo certificado antes do antigo expirar e permitir que ambos os certificados continuem a funcionar por um período de tempo.</span><span class="sxs-lookup"><span data-stu-id="ebc32-113">A new feature in Skype for Business Server will alleviate this problem - the ability to stage a new certificate in advance of the old one expiring and allowing both certificates to continue to function for a period of time.</span></span> <span data-ttu-id="ebc32-114">Esse recurso usa a funcionalidade atualizada no cmdlet Set-CsCertificate Shell de Gerenciamento do Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="ebc32-114">This feature uses updated functionality in the Set-CsCertificate Skype for Business Server Management Shell cmdlet.</span></span> <span data-ttu-id="ebc32-115">O novo parâmetro -Roll, com o parâmetro existente -EffectiveDate, colocará o novo certificado AudioVideoAuthentication no armazenamento de certificados.</span><span class="sxs-lookup"><span data-stu-id="ebc32-115">The new parameter -Roll, with the existing parameter -EffectiveDate, will place the new AudioVideoAuthentication certificate in the certificate store.</span></span> <span data-ttu-id="ebc32-116">O certificado AudioVideoAuthentication mais antigo ainda permanecerá para tokens emitidos para serem validados.</span><span class="sxs-lookup"><span data-stu-id="ebc32-116">The older AudioVideoAuthentication certificate will still remain for issued tokens to be validated against.</span></span> <span data-ttu-id="ebc32-117">A partir da colocação do novo certificado AudioVideoAuthentication, ocorrerá a seguinte série de eventos:</span><span class="sxs-lookup"><span data-stu-id="ebc32-117">Beginning with putting the new AudioVideoAuthentication certificate in place, the following series of events will occur:</span></span>
  
> [!TIP]
> <span data-ttu-id="ebc32-118">Usando os cmdlets do Shell de Gerenciamento do Skype for Business Server para gerenciar certificados, você pode solicitar certificados separados e distintos para cada finalidade no Servidor de Borda.</span><span class="sxs-lookup"><span data-stu-id="ebc32-118">Using the Skype for Business Server Management Shell cmdlets for managing certificates, you can request separate and distinct certificates for each purpose on the Edge Server.</span></span> <span data-ttu-id="ebc32-119">Usar o Assistente de Certificado no Assistente de Implantação do Skype for Business  Server ajuda você na criação de certificados, mas normalmente é do tipo padrão que faz com que todos os certificados usem para o Servidor de Borda em um único certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-119">Using the Certificate Wizard in the Skype for Business Server Deployment Wizard assists you in creating certificates, but is typically of the **default** type which couples all certificate uses for the Edge Server onto a single certificate.</span></span> <span data-ttu-id="ebc32-120">A prática recomendada se você for usar o recurso de certificado de rolagem é desafocar o certificado AudioVideoAuthentication de outras finalidades de certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-120">The recommended practice if you are going to use the rolling certificate feature is to decouple the AudioVideoAuthentication certificate from the other certificate purposes.</span></span> <span data-ttu-id="ebc32-121">Você pode provisionar e estágios um certificado do tipo Padrão, mas somente a parte AudioVideoAuthentication do certificado combinado se beneficiará da preparação.</span><span class="sxs-lookup"><span data-stu-id="ebc32-121">You can provision and stage a certificate of the Default type, but only the AudioVideoAuthentication portion of the combined certificate will benefit from the staging.</span></span> <span data-ttu-id="ebc32-122">Um usuário envolvido em (por exemplo) uma conversa de mensagens instantâneas quando o certificado expirar precisará sair e fazer logoff novamente para usar o novo certificado associado ao serviço de Borda de Acesso.</span><span class="sxs-lookup"><span data-stu-id="ebc32-122">A user involved in (for example) an instant messaging conversation when the certificate expires will need to log out and log back in to make use of the new certificate associated with the Access Edge service.</span></span> <span data-ttu-id="ebc32-123">Ocorrerá um comportamento semelhante para um usuário envolvido em uma webconferência usando o serviço de Borda de Webconferência.</span><span class="sxs-lookup"><span data-stu-id="ebc32-123">Similar behavior will occur for a user involved in a Web conference using the Web Conferencing Edge service.</span></span> <span data-ttu-id="ebc32-124">O certificado OAuthTokenIssuer é um tipo específico compartilhado em todos os servidores.</span><span class="sxs-lookup"><span data-stu-id="ebc32-124">The OAuthTokenIssuer certificate is a specific type that is shared across all servers.</span></span> <span data-ttu-id="ebc32-125">Você cria e gerencia o certificado em um só lugar e o certificado é armazenado no armazenamento de Gerenciamento Central para todos os outros servidores.</span><span class="sxs-lookup"><span data-stu-id="ebc32-125">You create and manage the certificate in one place and the certificate is stored in the Central Management store for all other servers.</span></span>
  
<span data-ttu-id="ebc32-126">Detalhes adicionais são necessários para compreender totalmente suas opções e requisitos ao usar o cmdlet Set-CsCertificate e usá-lo para estágios de certificados antes da expiração atual do certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-126">Additional detail is needed to fully understand your options and requirements when using the Set-CsCertificate cmdlet and using it to stage certificates prior to the current certificate expiring.</span></span> <span data-ttu-id="ebc32-127">O parâmetro -Roll é importante, mas essencialmente uma única finalidade.</span><span class="sxs-lookup"><span data-stu-id="ebc32-127">The -Roll parameter is important, but essentially single purpose.</span></span> <span data-ttu-id="ebc32-128">Se defini-lo como um parâmetro, você estará informando Set-CsCertificate que fornecerá informações sobre o certificado que será afetado definido por -Type (por exemplo, AudioVideoAuthentication e OAuthTokenIssuer), quando o certificado se tornará efetivo definido por -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="ebc32-128">If you define it as a parameter, you are telling Set-CsCertificate that you will be providing information about the certificate that will be affected defined by -Type (for example AudioVideoAuthentication and OAuthTokenIssuer), when the certificate will become effective defined by -EffectiveDate.</span></span>
  
 <span data-ttu-id="ebc32-129">**-Roll**: o parâmetro -Roll é necessário e tem dependências que devem ser fornecidas junto com ele.</span><span class="sxs-lookup"><span data-stu-id="ebc32-129">**-Roll**: The -Roll parameter is required and has dependencies that must be supplied along with it.</span></span> <span data-ttu-id="ebc32-130">Parâmetros necessários para definir totalmente quais certificados serão afetados e como eles serão aplicados:</span><span class="sxs-lookup"><span data-stu-id="ebc32-130">Required parameters to fully define which certificates will be affected and how they will be applied:</span></span>
  
 <span data-ttu-id="ebc32-131">**-EffectiveDate**: o parâmetro -EffectiveDate define quando o novo certificado se tornará co-ativo com o certificado atual.</span><span class="sxs-lookup"><span data-stu-id="ebc32-131">**-EffectiveDate**: The parameter -EffectiveDate defines when the new certificate will become co-active with the current certificate.</span></span> <span data-ttu-id="ebc32-132">O -EffectiveDate pode estar perto do tempo de expiração do certificado atual ou pode ser um período de tempo mais longo.</span><span class="sxs-lookup"><span data-stu-id="ebc32-132">The -EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time.</span></span> <span data-ttu-id="ebc32-133">Um -EffectiveDate mínimo recomendado para o certificado AudioVideoAuthentication seria de 8 horas, que é o tempo de vida de token padrão para tokens de serviço de Borda AV emitidos usando o certificado AudioVideoAuthentication.</span><span class="sxs-lookup"><span data-stu-id="ebc32-133">A recommended minimum -EffectiveDate for the AudioVideoAuthentication certificate would be 8 hours, which is the default token lifetime for AV Edge service tokens issued using the AudioVideoAuthentication certificate.</span></span>
  
<span data-ttu-id="ebc32-134">Durante a preparação de certificados OAuthTokenIssuer, há requisitos diferentes para o tempo de entrega antes que o certificado possa se tornar eficaz.</span><span class="sxs-lookup"><span data-stu-id="ebc32-134">When staging OAuthTokenIssuer certificates, there are different requirements for the lead time before the certificate can become effective.</span></span> <span data-ttu-id="ebc32-135">O tempo mínimo que o certificado OAuthTokenIssuer deve ter para seu tempo de entrega é de 24 horas antes do tempo de expiração do certificado atual.</span><span class="sxs-lookup"><span data-stu-id="ebc32-135">The minimum time that the OAuthTokenIssuer certificate should have for its lead time is 24 hours before the expiration time of the current certificate.</span></span> <span data-ttu-id="ebc32-136">O tempo de entrega estendido para a coexistência é devido a outras funções de servidor que dependem do certificado OAuthTokenIssuer (Exchange Server, por exemplo), que tem um tempo de retenção maior para os materiais de chave de criptografia e autenticação criados por certificados.</span><span class="sxs-lookup"><span data-stu-id="ebc32-136">The extended lead time for the coexistence is because of other server roles that are dependent on the OAuthTokenIssuer certificate (Exchange Server, for example) which has a longer retention time for certificate created authentication and encryption key materials.</span></span>
  
 <span data-ttu-id="ebc32-137">**-Thumbprint**: a impressão digital é um atributo no certificado que é exclusivo para esse certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-137">**-Thumbprint**: The thumbprint is an attribute on the certificate that is unique to that certificate.</span></span> <span data-ttu-id="ebc32-138">O parâmetro -Thumbprint é usado para identificar o certificado que será afetado pelas ações do Set-CsCertificate cmdlet.</span><span class="sxs-lookup"><span data-stu-id="ebc32-138">The -Thumbprint parameter is used to identify the certificate that will be affected by the actions of the Set-CsCertificate cmdlet.</span></span>
  
 <span data-ttu-id="ebc32-139">**-Type:** o parâmetro -Type pode aceitar um único tipo de uso de certificado ou uma lista separada por vírgulas de tipos de uso de certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-139">**-Type**: The -Type parameter can accept a single certificate usage type or a comma separated list of certificate usage types.</span></span> <span data-ttu-id="ebc32-140">Os tipos de certificado são aqueles que identificam para o cmdlet e para o servidor qual é a finalidade do certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-140">The certificate types are those that identify to the cmdlet and to the server what the purpose of the certificate is.</span></span> <span data-ttu-id="ebc32-141">Por exemplo, o tipo AudioVideoAuthentication deve ser usado pelo serviço de Borda A/V e pelo serviço de Autenticação AV.</span><span class="sxs-lookup"><span data-stu-id="ebc32-141">For example, type AudioVideoAuthentication is for use by the A/V Edge service and the AV Authentication service.</span></span> <span data-ttu-id="ebc32-142">Se você decidir estágio e provisionar certificados de um tipo diferente ao mesmo tempo, deverá considerar o prazo de entrega mínimo mínimo necessário para os certificados.</span><span class="sxs-lookup"><span data-stu-id="ebc32-142">If you decide to stage and provision certificates of a different type at the same time, you must consider the longest required minimum effective lead time for the certificates.</span></span> <span data-ttu-id="ebc32-143">Por exemplo, você precisa estágios certificados do tipo AudioVideoAuthentication e OAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="ebc32-143">For example, you need to stage certificates of type AudioVideoAuthentication and OAuthTokenIssuer.</span></span> <span data-ttu-id="ebc32-144">O -EffectiveDate mínimo deve ser o maior dos dois certificados, nesse caso, o OAuthTokenIssuer, que tem um prazo mínimo de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="ebc32-144">Your minimum -EffectiveDate must be the greater of the two certificates, in this case the OAuthTokenIssuer, which has a minimum lead time of 24 hours.</span></span> <span data-ttu-id="ebc32-145">Se você não quiser separar o certificado AudioVideoAuthentication com um prazo de 24 horas, estágio-lo separadamente com um EffectiveDate que seja mais para seus requisitos.</span><span class="sxs-lookup"><span data-stu-id="ebc32-145">If you do not want to stage the AudioVideoAuthentication certificate with a lead time of 24 hours, stage it separately with an EffectiveDate that is more to your requirements.</span></span>
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="ebc32-146">Para atualizar ou renovar um certificado de serviço de Borda A/V com parâmetros -Roll e -EffectiveDate</span><span class="sxs-lookup"><span data-stu-id="ebc32-146">To update or renew an A/V Edge service certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="ebc32-147">Faça logoff no computador local como membro do grupo Administradores.</span><span class="sxs-lookup"><span data-stu-id="ebc32-147">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="ebc32-148">Solicite uma renovação ou um novo certificado AudioVideoAuthentication com chave privada exportável para o certificado existente no serviço de Borda A/V.</span><span class="sxs-lookup"><span data-stu-id="ebc32-148">Request a renewal or new AudioVideoAuthentication certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>
    
3. <span data-ttu-id="ebc32-149">Importe o novo certificado AudioVideoAuthentication para o Servidor de Borda e todos os outros Servidores de Borda em seu pool (se você tiver um pool implantado).</span><span class="sxs-lookup"><span data-stu-id="ebc32-149">Import the new AudioVideoAuthentication certificate to the Edge Server and all other Edge Server in your pool (if you have a pool deployed).</span></span>
    
4. <span data-ttu-id="ebc32-150">Configure o certificado importado com o cmdlet Set-CsCertificate e use o parâmetro -Roll com o parâmetro -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="ebc32-150">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="ebc32-151">A data efetiva deve ser definida como a hora de expiração do certificado atual (14:00:00 ou 14:00:00 PM) menos tempo de vida do token (por padrão, oito horas).</span><span class="sxs-lookup"><span data-stu-id="ebc32-151">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus token lifetime (by default eight hours).</span></span> <span data-ttu-id="ebc32-152">Isso nos dá um tempo em que o certificado deve ser definido como ativo e é -EffectiveDate \<string\> : "22/7/2015 6:00:00 AM".</span><span class="sxs-lookup"><span data-stu-id="ebc32-152">This gives us a time that the certificate must be set to active, and is the -EffectiveDate \<string\>: "7/22/2015 6:00:00 AM".</span></span> 
    
    > [!IMPORTANT]
    > <span data-ttu-id="ebc32-153">Para um pool de Borda, você deve ter todos os certificados AudioVideoAuthentication implantados e provisionados pela data e hora definidas pelo parâmetro -EffectiveDate do primeiro certificado implantado para evitar possíveis interrupções nas comunicações A/V devido à expiração do certificado mais antigo antes que todos os tokens de cliente e consumidor tenham sido renovados usando o novo certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-153">For an Edge pool, you must have all AudioVideoAuthentication certificates deployed and provisioned by the date and time defined by the -EffectiveDate parameter of the first certificate deployed to avoid possible A/V communications disruption due to the older certificate expiring before all client and consumer tokens have been renewed using the new certificate.</span></span> 
  
    <span data-ttu-id="ebc32-154">O Set-CsCertificate comando com o parâmetro -Roll e -EffectiveTime:</span><span class="sxs-lookup"><span data-stu-id="ebc32-154">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    <span data-ttu-id="ebc32-155">Um exemplo Set-CsCertificate comando:</span><span class="sxs-lookup"><span data-stu-id="ebc32-155">An example Set-CsCertificate command:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > <span data-ttu-id="ebc32-156">EffectiveDate deve ser formatado para corresponder às configurações de idioma e região do seu servidor.</span><span class="sxs-lookup"><span data-stu-id="ebc32-156">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="ebc32-157">O exemplo usa as configurações de Idioma e Região Inglês dos EUA</span><span class="sxs-lookup"><span data-stu-id="ebc32-157">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="ebc32-158">Para entender ainda mais o processo que Set-CsCertificate, -Roll e -EffectiveDate usam para configurar um novo certificado para emissão de novos tokens AudioVideoAuthentication enquanto ainda usa um certificado existente para validar AudioVideoAuthentication que estão em uso pelos consumidores, uma linha do tempo visual é um meio eficaz de entender o processo.</span><span class="sxs-lookup"><span data-stu-id="ebc32-158">To further understand the process that Set-CsCertificate, -Roll, and -EffectiveDate use to stage a new certificate for issuing new AudioVideoAuthentication tokens while still using an existing certificate to validate AudioVideoAuthentication that are in use by consumers, a visual timeline is an effective means of understanding the process.</span></span> <span data-ttu-id="ebc32-159">No exemplo a seguir, o administrador determina que o certificado do serviço de Borda A/V deve expirar às 14:00 em 22/07/2015.</span><span class="sxs-lookup"><span data-stu-id="ebc32-159">In the following example, the administrator determines that the A/V Edge service certificate is due to expire at 2:00:00 PM on 07/22/2015.</span></span> <span data-ttu-id="ebc32-160">Ele solicita e recebe um novo certificado e o importa para cada Servidor de Borda em seu pool.</span><span class="sxs-lookup"><span data-stu-id="ebc32-160">He requests and receives a new certificate and imports it to each Edge Server in his pool.</span></span> <span data-ttu-id="ebc32-161">Às 2h do dia 22/07/2015, ele começa a executar o Get-CsCertificate com -Roll, -Thumbprint igual à cadeia de impressão digital do novo certificado e -EffectiveTime definido como 22/07/2015 6:00:00 AM.</span><span class="sxs-lookup"><span data-stu-id="ebc32-161">At 2 AM on 07/22/2015, he begins running Get-CsCertificate with -Roll, -Thumbprint equal to the thumbprint string of the new certificate, and -EffectiveTime set to 07/22/2015 6:00:00 AM.</span></span> <span data-ttu-id="ebc32-162">Ele executa este comando em cada Servidor de Borda.</span><span class="sxs-lookup"><span data-stu-id="ebc32-162">He runs this command on each Edge Server.</span></span>
  
![Usando os parâmetros Roll e EffectiveDate.](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|<span data-ttu-id="ebc32-164">**Callout**</span><span class="sxs-lookup"><span data-stu-id="ebc32-164">**Callout**</span></span>|<span data-ttu-id="ebc32-165">**Etapa**</span><span class="sxs-lookup"><span data-stu-id="ebc32-165">**Stage**</span></span>|
|:-----|:-----|
|<span data-ttu-id="ebc32-166">1 </span><span class="sxs-lookup"><span data-stu-id="ebc32-166">1</span></span>  <br/> |<span data-ttu-id="ebc32-167">Início: 22/07/2015 12:00:00</span><span class="sxs-lookup"><span data-stu-id="ebc32-167">Start: 7/22/2015 12:00:00 AM</span></span>  <br/> <span data-ttu-id="ebc32-168">O certificado AudioVideoAuthentication atual deve expirar às 14:00 em 22/07/2015.</span><span class="sxs-lookup"><span data-stu-id="ebc32-168">The current AudioVideoAuthentication certificate is due to expire at 2:00:00 PM on 7/22/2015.</span></span> <span data-ttu-id="ebc32-169">Isso é determinado pelo carimbo de data/hora expira no certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-169">This is determined by the expires time stamp on the certificate.</span></span> <span data-ttu-id="ebc32-170">Planeje a substituição e a sobreposição de certificados para levar em conta uma sobreposição de 8 horas (tempo de vida do token padrão) antes que o certificado existente atinja a hora de expiração.</span><span class="sxs-lookup"><span data-stu-id="ebc32-170">Plan your certificate replacement and rollover to account for an 8 hour overlap (default token lifetime) before the existing certificate reaches the expire time.</span></span> <span data-ttu-id="ebc32-171">O prazo 2:00:00 é usado neste exemplo para permitir que o administrador coloque e provisione os novos certificados antes da hora efetiva das 6:00:00.</span><span class="sxs-lookup"><span data-stu-id="ebc32-171">The 2:00:00 AM lead time is used in this example to allow the administrator adequate time to place and provision the new certificates in advance of the 6:00:00 AM effective time.</span></span>  <br/> |
|<span data-ttu-id="ebc32-172">2 </span><span class="sxs-lookup"><span data-stu-id="ebc32-172">2</span></span>  <br/> |<span data-ttu-id="ebc32-173">22/7/2015 02:00:00 - 22/07/2015 05:59:59</span><span class="sxs-lookup"><span data-stu-id="ebc32-173">7/22/2015 2:00:00 AM - 7/22/2015 5:59:59 AM</span></span>  <br/> <span data-ttu-id="ebc32-174">Definir Certificados em Servidores de Borda com tempo efetivo de 6:00:00 (o prazo de 4 horas é para este exemplo, mas pode ser maior) usando Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\></span><span class="sxs-lookup"><span data-stu-id="ebc32-174">Set Certificates on Edge Servers with effective time of 6:00:00 AM (4 hour lead time is for this example, but can be longer) using Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\></span></span>  <br/> |
|<span data-ttu-id="ebc32-175">3 </span><span class="sxs-lookup"><span data-stu-id="ebc32-175">3</span></span>  <br/> |<span data-ttu-id="ebc32-176">22/07/2015 06:00 - 22/07/2015 14:00</span><span class="sxs-lookup"><span data-stu-id="ebc32-176">7/22/2015 6:00 AM - 7/22/2015 2:00 PM</span></span>  <br/> <span data-ttu-id="ebc32-177">Para validar tokens, o novo certificado é experimentado primeiro e, se o novo certificado não validar o token, o certificado antigo é experimentado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-177">To validate tokens, the new certificate is tried first, and if the new certificate fails to validate the token, the old certificate is tried.</span></span> <span data-ttu-id="ebc32-178">Esse processo é usado para todos os tokens durante o período de sobreposição de 8 horas (tempo de vida do token padrão).</span><span class="sxs-lookup"><span data-stu-id="ebc32-178">This process is used for all tokens during the 8 hour (default token lifetime) overlap period.</span></span>  <br/> |
|<span data-ttu-id="ebc32-179">4 </span><span class="sxs-lookup"><span data-stu-id="ebc32-179">4</span></span>  <br/> |<span data-ttu-id="ebc32-180">Término: 22/07/2015 14:00:01</span><span class="sxs-lookup"><span data-stu-id="ebc32-180">End: 7/22/2015 2:00:01 PM</span></span>  <br/> <span data-ttu-id="ebc32-181">O certificado antigo expirou e o novo certificado foi assumido.</span><span class="sxs-lookup"><span data-stu-id="ebc32-181">Old certificate has expired and the new certificate has taken over.</span></span> <span data-ttu-id="ebc32-182">O certificado antigo pode ser removido com segurança Remove-CsCertificate -Type \<certificate usage type\> -Previous</span><span class="sxs-lookup"><span data-stu-id="ebc32-182">Old certificate can be safely removed with Remove-CsCertificate -Type \<certificate usage type\> -Previous</span></span>  <br/> |
   
<span data-ttu-id="ebc32-183">Quando a hora efetiva é atingida (22/7/2015 6:00:00 AM), todos os novos tokens são emitidos pelo novo certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-183">When the effective time is reached (7/22/2015 6:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="ebc32-184">Ao validar tokens, os tokens serão validados primeiro no novo certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-184">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="ebc32-185">Se a validação falhar, o certificado antigo será experimentado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-185">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="ebc32-186">O processo de tentar o novo e retornar ao certificado antigo continuará até o tempo de expiração do certificado antigo.</span><span class="sxs-lookup"><span data-stu-id="ebc32-186">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="ebc32-187">Depois que o certificado antigo expirar (22/07/2015 14:00:00), os tokens só serão validados pelo novo certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-187">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="ebc32-188">O certificado antigo pode ser removido com segurança usando o cmdlet Remove-CsCertificate com o parâmetro -Previous.</span><span class="sxs-lookup"><span data-stu-id="ebc32-188">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="ebc32-189">Para atualizar ou renovar um certificado OAuthTokenIssuer com parâmetros -Roll e -EffectiveDate</span><span class="sxs-lookup"><span data-stu-id="ebc32-189">To update or renew an OAuthTokenIssuer certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="ebc32-190">Faça logoff no computador local como membro do grupo Administradores.</span><span class="sxs-lookup"><span data-stu-id="ebc32-190">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="ebc32-191">Solicite uma renovação ou um novo certificado OAuthTokenIssuer com chave privada exportável para o certificado existente no Servidor Front-End.</span><span class="sxs-lookup"><span data-stu-id="ebc32-191">Request a renewal or new OAuthTokenIssuer certificate with exportable private key for the existing certificate on the Front End Server.</span></span>
    
3. <span data-ttu-id="ebc32-192">Importe o novo certificado OAuthTokenIssuer para um Servidor Front End em seu pool (se você tiver um pool implantado).</span><span class="sxs-lookup"><span data-stu-id="ebc32-192">Import the new OAuthTokenIssuer certificate to a Front End Server in your pool (if you have a pool deployed).</span></span> <span data-ttu-id="ebc32-193">O certificado OAuthTokenIssuer é replicado globalmente e só precisa ser atualizado e renovado em qualquer servidor em sua implantação.</span><span class="sxs-lookup"><span data-stu-id="ebc32-193">The OAuthTokenIssuer certificate is replicated globally and only needs to be updated and renewed at any server in your deployment.</span></span> <span data-ttu-id="ebc32-194">O Servidor front-end é usado como exemplo.</span><span class="sxs-lookup"><span data-stu-id="ebc32-194">The Front End Server is used as an example.</span></span>
    
4. <span data-ttu-id="ebc32-195">Configure o certificado importado com o cmdlet Set-CsCertificate e use o parâmetro -Roll com o parâmetro -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="ebc32-195">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="ebc32-196">A data efetiva deve ser definida como o tempo de expiração do certificado atual (14:00:00 ou 14:00:00) menos um mínimo de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="ebc32-196">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus a minimum of 24 hours.</span></span> 
    
    <span data-ttu-id="ebc32-197">O Set-CsCertificate comando com o parâmetro -Roll e -EffectiveTime:</span><span class="sxs-lookup"><span data-stu-id="ebc32-197">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

<span data-ttu-id="ebc32-198">Um exemplo Set-CsCertificate comando:</span><span class="sxs-lookup"><span data-stu-id="ebc32-198">An example Set-CsCertificate command:</span></span>
    
  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> <span data-ttu-id="ebc32-199">EffectiveDate deve ser formatado para corresponder às configurações de idioma e região do seu servidor.</span><span class="sxs-lookup"><span data-stu-id="ebc32-199">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="ebc32-200">O exemplo usa as configurações de Idioma e Região Inglês dos EUA</span><span class="sxs-lookup"><span data-stu-id="ebc32-200">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="ebc32-201">Quando a hora efetiva é atingida (21/07/2015 1:00:00 AM), todos os novos tokens são emitidos pelo novo certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-201">When the effective time is reached (7/21/2015 1:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="ebc32-202">Ao validar tokens, os tokens serão validados primeiro no novo certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-202">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="ebc32-203">Se a validação falhar, o certificado antigo será experimentado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-203">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="ebc32-204">O processo de tentar o novo e retornar ao certificado antigo continuará até o tempo de expiração do certificado antigo.</span><span class="sxs-lookup"><span data-stu-id="ebc32-204">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="ebc32-205">Depois que o certificado antigo expirar (22/07/2015 14:00:00), os tokens só serão validados pelo novo certificado.</span><span class="sxs-lookup"><span data-stu-id="ebc32-205">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="ebc32-206">O certificado antigo pode ser removido com segurança usando o cmdlet Remove-CsCertificate com o parâmetro -Previous.</span><span class="sxs-lookup"><span data-stu-id="ebc32-206">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>
```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a><span data-ttu-id="ebc32-207">Confira também</span><span class="sxs-lookup"><span data-stu-id="ebc32-207">See also</span></span>

[<span data-ttu-id="ebc32-208">Gerenciar a autenticação de servidor para servidor (OAuth) e aplicativos de parceiros no Skype for Business Server</span><span class="sxs-lookup"><span data-stu-id="ebc32-208">Manage server-to-server authentication (OAuth) and partner applications in Skype for Business Server</span></span>](server-to-server-and-partner-applications.md)

[<span data-ttu-id="ebc32-209">Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="ebc32-209">Set-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[<span data-ttu-id="ebc32-210">Remove-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="ebc32-210">Remove-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/remove-cscertificate?view=skype-ps)
